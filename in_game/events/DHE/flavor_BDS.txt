namespace = flavor_bds

scripted_trigger bds_is_valid_lawlessness_location = {
	owner ?= root
	area = area:iraq_ajam_area
}

scripted_trigger bds_is_southern_ajam_location = {
	OR = {
		location = rey
		location = karaj
		location = savojbolagh
		location = qazvin
		location = takestan
		location = soltaniyeh
		location = sirdan
		location = rudbar
	}
}

flavor_bds.1 = {
	type = country_event
	category = disaster_event
	title = flavor_bds.1.title
	desc = flavor_bds.1.desc
	fire_only_once = yes
	trigger = {
		tag = BDS
		any_owned_location = {
			area = area:iraq_ajam_area
		}
	}

	image = "gfx/interface/illustrations/disaster/religious_turmoil.dds"

	immediate = {
		every_owned_location = {
			limit = {
				bds_is_valid_lawlessness_location = yes
				OR = {
					location_rank = location_rank:rural_settlement
					location_rank = location_rank:town
				}
			}
			if = {
				limit = { province = { NOT = { has_province_modifier = bds_ayyar_bands } } }
				province = {
					add_province_modifier = { modifier = bds_ayyar_bands years = 8 mode = add }
				}
			}
			change_control = control_mild_penalty
		}
	}

	option = {
		name = flavor_bds.1.a
		historical_option = yes
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_weak_bonus }
		add_estate_satisfaction = { type = estate_type:peasants_estate value = estate_satisfaction_weak_penalty }
		custom_tooltip = bds_use_cabinet_action_to_restore_order
	}

	historical_info = flavor_bds.1.historical_info
}

flavor_bds.2 = {
	type = country_event
	category = disaster_event
	title = flavor_bds.2.title
	desc = flavor_bds.2.desc
	trigger = {
		tag = BDS
		any_active_disaster = {
			disaster_type = disaster_type:bds_ayyar_bands_disaster
		}
		any_owned_location = {
			area = area:iraq_ajam_area
			province = {
				NOT = { has_province_modifier = bds_ayyar_bands }
			}
		}
	}

	image = "gfx/interface/illustrations/disaster/religious_turmoil.dds"

	immediate = {
		random_owned_location = {
			limit = {
				area = area:iraq_ajam_area
				province = {
					NOT = { has_province_modifier = bds_ayyar_bands }
				}
			}
			save_scope_as = target_location
		}
	}

	option = {
		name = flavor_bds.2.a
		change_gold_effect = { scale = -3 }
		add_prestige = prestige_weak_bonus
		scope:target_location = {
			change_control = control_mild_bonus
		}
	}

	option = {
		name = flavor_bds.2.b
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_weak_bonus }
		add_estate_satisfaction = { type = estate_type:peasants_estate value = estate_satisfaction_weak_penalty }
		scope:target_location = {
			province = {
				add_province_modifier = { modifier = bds_ayyar_bands years = 8 mode = add }
			}
			change_control = control_mild_penalty
		}
	}

	historical_info = flavor_bds.2.historical_info
}

flavor_bds.3 = {
	type = country_event
	category = disaster_event
	title = flavor_bds.3.title
	desc = flavor_bds.3.desc
	fire_only_once = yes

	image = "gfx/interface/illustrations/disaster/religious_turmoil.dds"

	option = {
		name = flavor_bds.3.a
		remove_country_modifier = bds_ilkhanate_power_vacuum
		remove_variable = bds_ayyar_bands_active
		add_prestige = prestige_mild_bonus
		add_legitimacy = legitimacy_weak_bonus
	}

	historical_info = flavor_bds.3.historical_info
}

flavor_bds.4 = {
	type = country_event
	category = disaster_event
	title = flavor_bds.4.title
	desc = flavor_bds.4.desc
	trigger = {
		tag = BDS
		any_active_disaster = {
			disaster_type = disaster_type:bds_ayyar_bands_disaster
		}
		any_owned_location = {
			area = area:iraq_ajam_area
			bds_is_southern_ajam_location = yes
			any_pop = {
				NOT = { religion = religion:shia }
			}
		}
	}

	image = "gfx/interface/illustrations/disaster/religious_turmoil.dds"

	immediate = {
		random_owned_location = {
			limit = {
				area = area:iraq_ajam_area
				bds_is_southern_ajam_location = yes
				any_pop = {
					NOT = { religion = religion:shia }
				}
			}
			save_scope_as = target_location
		}
	}

	option = {
		name = flavor_bds.4.a
		historical_option = yes
		change_gold_effect = { scale = -4 }
		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_mild_bonus }
		scope:target_location = {
			every_pop = {
				limit = {
					NOT = { religion = religion:shia }
				}
				change_pop_religion = religion:shia
			}
			change_control = control_mild_bonus
		}
	}

	option = {
		name = flavor_bds.4.b
		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_weak_penalty }
		scope:target_location = {
			change_control = control_mild_penalty
		}
	}

	historical_info = flavor_bds.4.historical_info
}

flavor_bds.5 = {
	type = country_event
	category = disaster_event
	title = flavor_bds.5.title
	desc = flavor_bds.5.desc
	trigger = {
		tag = BDS
		any_active_disaster = {
			disaster_type = disaster_type:bds_ayyar_bands_disaster
		}
		any_owned_location = {
			area = area:iraq_ajam_area
			bds_is_southern_ajam_location = yes
			province = {
				NOT = { has_province_modifier = bds_ayyar_bands }
			}
		}
	}

	image = "gfx/interface/illustrations/disaster/religious_turmoil.dds"

	immediate = {
		random_owned_location = {
			limit = {
				area = area:iraq_ajam_area
				bds_is_southern_ajam_location = yes
				province = {
					NOT = { has_province_modifier = bds_ayyar_bands }
				}
			}
			save_scope_as = target_location
		}
	}

	option = {
		name = flavor_bds.5.a
		change_gold_effect = { scale = -2 }
		scope:target_location = {
			change_control = control_mild_bonus
		}
	}

	option = {
		name = flavor_bds.5.b
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_weak_penalty }
		scope:target_location = {
			province = {
				add_province_modifier = { modifier = bds_ayyar_bands years = 8 mode = add }
			}
			change_control = control_mild_penalty
		}
	}

	historical_info = flavor_bds.5.historical_info
}
